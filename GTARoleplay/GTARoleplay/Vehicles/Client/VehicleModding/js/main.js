const stockWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Inferno", "mod": 23, "value": 0 },
    { "name": "Deepfive", "mod": 23, "value": 1 },
    { "name": "Lozspeed", "mod": 23, "value": 2 },
    { "name": "Diamondcut", "mod": 23, "value": 3 },
    { "name": "Chrono", "mod": 23, "value": 4 },
    { "name": "Feroccirr", "mod": 23, "value": 5 },
    { "name": "Fiftynine", "mod": 23, "value": 6 },
    { "name": "Mercie", "mod": 23, "value": 7 },
    { "name": "Syntheticz", "mod": 23, "value": 8 },
    { "name": "Organictyped", "mod": 23, "value": 9 },
    { "name": "Endov1", "mod": 23, "value": 10 },
    { "name": "Duper7", "mod": 23, "value": 11 },
    { "name": "Uzer", "mod": 23, "value": 12 },
    { "name": "Groundride", "mod": 23, "value": 13 },
    { "name": "Spacer", "mod": 23, "value": 14 },
    { "name": "Venum", "mod": 23, "value": 15 },
    { "name": "Cosmo", "mod": 23, "value": 16 },
    { "name": "Dashvip", "mod": 23, "value": 17 },
    { "name": "Icekid", "mod": 23, "value": 18 },
    { "name": "Ruffeld", "mod": 23, "value": 19 },
    { "name": "Wangenmaster", "mod": 23, "value": 20 },
    { "name": "Superfive", "mod": 23, "value": 21 },
    { "name": "Endov2", "mod": 23, "value": 22 },
    { "name": "Slitsix", "mod": 23, "value": 23 }
];
const muscleWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Classicfive", "mod": 23, "value": 0 },
    { "name": "Dukes", "mod": 23, "value": 1 },
    { "name": "Musclefreak", "mod": 23, "value": 2 },
    { "name": "Kracka", "mod": 23, "value": 3 },
    { "name": "Azrea", "mod": 23, "value": 4 },
    { "name": "Mecha", "mod": 23, "value": 5 },
    { "name": "Blacktop", "mod": 23, "value": 6 },
    { "name": "Dragspl", "mod": 23, "value": 7 },
    { "name": "Revolver", "mod": 23, "value": 8 },
    { "name": "Classicrod", "mod": 23, "value": 9 },
    { "name": "Spooner", "mod": 23, "value": 10 },
    { "name": "Fivestar", "mod": 23, "value": 11 },
    { "name": "Oldschool", "mod": 23, "value": 12 },
    { "name": "Eljefe", "mod": 23, "value": 13 },
    { "name": "Dodman", "mod": 23, "value": 14 },
    { "name": "Sixgun", "mod": 23, "value": 15 },
    { "name": "Mercenary", "mod": 23, "value": 16 }
];
const lowRiderWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Flare", "mod": 23, "value": 0 },
    { "name": "Wired", "mod": 23, "value": 1 },
    { "name": "Triplegolds", "mod": 23, "value": 2 },
    { "name": "Bigworm", "mod": 23, "value": 3 },
    { "name": "Sevenfives", "mod": 23, "value": 4 },
    { "name": "Splitsix", "mod": 23, "value": 5 },
    { "name": "Freshmesh", "mod": 23, "value": 6 },
    { "name": "Leadsled", "mod": 23, "value": 7 },
    { "name": "Turbine", "mod": 23, "value": 8 },
    { "name": "Superfin", "mod": 23, "value": 9 },
    { "name": "Classicrod", "mod": 23, "value": 10 },
    { "name": "Dollar", "mod": 23, "value": 11 },
    { "name": "Dukes", "mod": 23, "value": 12 },
    { "name": "Lowfive", "mod": 23, "value": 13 },
    { "name": "Gooch", "mod": 23, "value": 14 }
];
const suvWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Vip", "mod": 23, "value": 0 },
    { "name": "Benefactor", "mod": 23, "value": 1 },
    { "name": "Cosmo", "mod": 23, "value": 2 },
    { "name": "Bippu", "mod": 23, "value": 3 },
    { "name": "Royalsix", "mod": 23, "value": 4 },
    { "name": "Fagorme", "mod": 23, "value": 5 },
    { "name": "Deluxe", "mod": 23, "value": 6 },
    { "name": "Icedout", "mod": 23, "value": 7 },
    { "name": "Cognscenti", "mod": 23, "value": 8 },
    { "name": "Lozspeedten", "mod": 23, "value": 9 },
    { "name": "Supernova", "mod": 23, "value": 10 },
    { "name": "Obeyrs", "mod": 23, "value": 11 },
    { "name": "Lozspeedballer", "mod": 23, "value": 12 },
    { "name": "Extra vaganzo", "mod": 23, "value": 13 },
    { "name": "Splitsix", "mod": 23, "value": 14 },
    { "name": "Empowered", "mod": 23, "value": 15 },
    { "name": "Sunrise", "mod": 23, "value": 16 },
    { "name": "Dashvip", "mod": 23, "value": 17 },
    { "name": "Cutter", "mod": 23, "value": 18 }
];
const offroadWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Raider", "mod": 23, "value": 0 },
    { "name": "Mudslinger", "mod": 23, "value": 1 },
    { "name": "Nevis", "mod": 23, "value": 2 },
    { "name": "Cairngorm", "mod": 23, "value": 3 },
    { "name": "Amazon", "mod": 23, "value": 4 },
    { "name": "Challenger", "mod": 23, "value": 5 },
    { "name": "Dunebasher", "mod": 23, "value": 6 },
    { "name": "Fivestar", "mod": 23, "value": 7 },
    { "name": "Rockcrawler", "mod": 23, "value": 8 },
    { "name": "Milspecsteelie", "mod": 23, "value": 9 }
];
const tunerWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Cosmo", "mod": 23, "value": 0 },
    { "name": "Supermesh", "mod": 23, "value": 1 },
    { "name": "Outsider", "mod": 23, "value": 2 },
    { "name": "Rollas", "mod": 23, "value": 3 },
    { "name": "Driffmeister", "mod": 23, "value": 4 },
    { "name": "Slicer", "mod": 23, "value": 5 },
    { "name": "Elquatro", "mod": 23, "value": 6 },
    { "name": "Dubbed", "mod": 23, "value": 7 },
    { "name": "Fivestar", "mod": 23, "value": 8 },
    { "name": "Slideways", "mod": 23, "value": 9 },
    { "name": "Apex", "mod": 23, "value": 10 },
    { "name": "Stancedeg", "mod": 23, "value": 11 },
    { "name": "Countersteer", "mod": 23, "value": 12 },
    { "name": "Endov1", "mod": 23, "value": 13 },
    { "name": "Endov2dish", "mod": 23, "value": 14 },
    { "name": "Guppez", "mod": 23, "value": 15 },
    { "name": "Chokadori", "mod": 23, "value": 16 },
    { "name": "Chicane", "mod": 23, "value": 17 },
    { "name": "Saisoku", "mod": 23, "value": 18 },
    { "name": "Dishedeight", "mod": 23, "value": 19 },
    { "name": "Fujiwara", "mod": 23, "value": 20 },
    { "name": "Zokusha", "mod": 23, "value": 21 },
    { "name": "Battlevill", "mod": 23, "value": 22 },
    { "name": "Rallymaster", "mod": 23, "value": 23 }
];
const bikeWheels = [
    { "name": "Fw Stock", "mod": 23, "value": -1 },
    { "name": "Fw Speedway", "mod": 23, "value": 0 },
    { "name": "Fw Streetspecial", "mod": 23, "value": 1 },
    { "name": "Fw Racer", "mod": 23, "value": 2 },
    { "name": "Fw Trackstar", "mod": 23, "value": 3 },
    { "name": "Fw Overlord", "mod": 23, "value": 4 },
    { "name": "Fw Trident", "mod": 23, "value": 5 },
    { "name": "Fw Triplethreat", "mod": 23, "value": 6 },
    { "name": "Fw Stilleto", "mod": 23, "value": 7 },
    { "name": "Fw Wires", "mod": 23, "value": 8 },
    { "name": "Fw Bobber", "mod": 23, "value": 9 },
    { "name": "Fw Solidus", "mod": 23, "value": 10 },
    { "name": "Fw Iceshield", "mod": 23, "value": 11 },
    { "name": "Fw Loops", "mod": 23, "value": 12 },
    { "name": "Rw Stock", "mod": 24, "value": -1 },
    { "name": "Rw Speedway", "mod": 24, "value": 0 },
    { "name": "Rw Streetspecial", "mod": 24, "value": 1 },
    { "name": "Rw Racer", "mod": 24, "value": 2 },
    { "name": "Rw Trackstar", "mod": 24, "value": 3 },
    { "name": "Rw Overlord", "mod": 24, "value": 4 },
    { "name": "Rw Trident", "mod": 24, "value": 5 },
    { "name": "Rw Triplethreat", "mod": 24, "value": 6 },
    { "name": "Rw Stilleto", "mod": 24, "value": 7 },
    { "name": "Rw Wires", "mod": 24, "value": 8 },
    { "name": "Rw Bobber", "mod": 24, "value": 9 },
    { "name": "Rw Solidus", "mod": 24, "value": 10 },
    { "name": "Rw Iceshield", "mod": 24, "value": 11 },
    { "name": "Rw Loops", "mod": 24, "value": 12 }

];
const highendWheels = [
    { "name": "Stock", "mod": 23, "value": -1 },
    { "name": "Shadow", "mod": 23, "value": 0 },
    { "name": "Hyper", "mod": 23, "value": 1 },
    { "name": "Blade", "mod": 23, "value": 2 },
    { "name": "Diamond", "mod": 23, "value": 3 },
    { "name": "Supagee", "mod": 23, "value": 4 },
    { "name": "Chromaticz", "mod": 23, "value": 5 },
    { "name": "Merciechlip", "mod": 23, "value": 6 },
    { "name": "Obeyrs", "mod": 23, "value": 7 },
    { "name": "Gtchrome", "mod": 23, "value": 8 },
    { "name": "Cheetahr", "mod": 23, "value": 9 },
    { "name": "Solar", "mod": 23, "value": 10 },
    { "name": "Splitten", "mod": 23, "value": 11 },
    { "name": "Dashvip", "mod": 23, "value": 12 },
    { "name": "Lozspeedten", "mod": 23, "value": 13 },
    { "name": "Carboninferno", "mod": 23, "value": 14 },
    { "name": "Carbonshadow", "mod": 23, "value": 15 },
    { "name": "Carbonz", "mod": 23, "value": 16 },
    { "name": "Carbonsolar", "mod": 23, "value": 17 },
    { "name": "Carboncheetahr", "mod": 23, "value": 18 },
    { "name": "Carbonsracer", "mod": 23, "value": 19 },
];
const allWheels = [stockWheels, muscleWheels, lowRiderWheels, suvWheels, offroadWheels, tunerWheels, bikeWheels, highendWheels];

var currentPrimaryColor = null;
var currentSecondaryColor = null;

var oldPrimaryColor = null;
var oldPrimaryColorAsObj = null;
var oldSecondaryColor = null;
var oldSecondaryColorAsObj = null;

var currentWheelType = null;
var currentWheel = null;
var currentWheelModType = null;

var modValuesToBuy = {};

function setupSubMenus(tmpData){
    var data = JSON.parse(tmpData);
    if(!data)
        return;

    oldPrimaryColor = `rgb(${data.primaryColor.r},${data.primaryColor.g},${data.primaryColor.b})`;
    oldPrimaryColorAsObj = data.primaryColor;
    oldSecondaryColor = `rgb(${data.secondaryColor.r},${data.secondaryColor.g},${data.secondaryColor.b})`;
    oldSecondaryColorAsObj = data.secondaryColor;
    setupColorPicker("#color-picker-primary", oldPrimaryColor);
    setupColorPicker("#color-picker-secondary", oldSecondaryColor);

    setupSpoilers(data.spoilers);
    setupFrontBumpers(data.frontBumpers);
    setupRearBumpers(data.rearBumpers);
    setupSkirts(data.skirts);
    setupExhausts(data.exhauts);
    setupGrilles(data.grilles);
    setupHoods(data.hoods);
    setupFenders(data.leftFenders, data.rightFenders);
    setupRoofs(data.roofs);
    setupFrames(data.frames);
    setupSteeringWheels(data.steeringWheels);
    setupEngineBoostAndTurbo();
    setupBrakes();
    setupTransmissions();
    setupSuspensionsAndHydraulics(data.hydraulics);
    setupHorns();
    setupPlates();
    setupArmorsAndWindows(data.armors);

    $(".js-range-slider").ionRangeSlider({
        type: "single",
        skin: "round",
        min: 0,
        max: 360,
        step: 1,
        grid: true
    });
    $(document).on('input', '#rotateSlider', function() {
        mp.trigger("SetVehicleRotation::Client", $(this).val());
    });
}

function setupSpoilers(spoilers){
    for(var i = -1; i < spoilers; i++){
        $("#spoilers").append(`<button type='button' mod-value='0' value='${i}' class='list-group-item list-group-item-action mods'>Spoiler ${i + 2}</button>`);
    }
}

function setupFrontBumpers(bumpers){
    for(var i = -1; i < bumpers; i++){
        $("#frontBumpers").append(`<button type='button' mod-value='1' value='${i}' class='list-group-item list-group-item-action mods'>Front bumper ${i + 2}</button>`);
    }
}

function setupRearBumpers(bumpers){
    for(var i = -1; i < bumpers; i++){
        $("#rearBumpers").append(`<button type='button' mod-value='2' value='${i}' class='list-group-item list-group-item-action mods'>Rear bumper ${i + 2}</button>`);
    }
}

function setupSkirts(skirts){
    for(var i = -1; i < skirts; i++){
        $("#skirts").append(`<button type='button' mod-value='3' value='${i}' class='list-group-item list-group-item-action mods'>Skirt ${i + 2}</button>`);
    }
}

function setupExhausts(exhauts){
    for(var i = -1; i < exhauts; i++){
        $("#exhauts").append(`<button type='button' mod-value='4' value='${i}' class='list-group-item list-group-item-action mods'>Exhaut ${i + 2}</button>`);
    }
}

function setupGrilles(grilles){
    for(var i = -1; i < grilles; i++){
        $("#grilles").append(`<button type='button' mod-value='6' value='${i}' class='list-group-item list-group-item-action mods'>Grille ${i + 2}</button>`);
    }
}

function setupHoods(hoods){
    for(var i = -1; i < hoods; i++){
        $("#hoods").append(`<button type='button' mod-value='7' value='${i}' class='list-group-item list-group-item-action mods'>Hood ${i + 2}</button>`);
    }
}

function setupFenders(leftFenders, rightFenders){
    for(var i = -1; i < leftFenders; i++){
        $("#leftFenders").append(`<button type='button' mod-value='8' value='${i}' class='list-group-item list-group-item-action mods'>Left fender ${i + 2}</button>`);
    }
    for(var i = -1; i < rightFenders; i++){
        $("#rightFenders").append(`<button type='button' mod-value='9' value='${i}' class='list-group-item list-group-item-action mods'>Right fender ${i + 2}</button>`);
    }
}

function setupRoofs(roofs){
    for(var i = -1; i < roofs; i++){
        $("#roofs").append(`<button type='button' mod-value='10' value='${i}' class='list-group-item list-group-item-action mods'>Roof ${i + 2}</button>`);
    }
}

function setupFrames(frames){
    for(var i = -1; i < frames; i++){
        $("#frames").append(`<button type='button' mod-value='5' value='${i}' class='list-group-item list-group-item-action mods'>Frame ${i + 2}</button>`);
    }
}

function setupSteeringWheels(steeringWheels){
    for(var i = -1; i < steeringWheels; i++){
        $("#steeringWheels").append(`<button type='button' mod-value='33' value='${i}' class='list-group-item list-group-item-action mods'>Steeringwheel ${i + 2}</button>`);
    }
}

function setupEngineBoostAndTurbo(){
    for(var i = -1; i < 4; i++){
        $("#engines").append(`<button type='button' mod-value='11' value='${i}' class='list-group-item list-group-item-action mods'>Engine ${i + 2}</button>`);
    }
    for(var i = -1; i < 4; i++){
        $("#boosts").append(`<button type='button' mod-value='40' value='${i}' class='list-group-item list-group-item-action mods'>Boost ${i + 2}</button>`);
    }
    for(var i = -1; i < 2; i++){
        $("#turbos").append(`<button type='button' mod-value='18' value='${i}' class='list-group-item list-group-item-action mods'>Turbo ${i + 2}</button>`);
    }
}

function setupBrakes(){
    for(var i = -1; i < 3; i++){
        $("#brakes").append(`<button type='button' mod-value='12' value='${i}' class='list-group-item list-group-item-action mods'>Brake ${i + 2}</button>`);
    }
}

function setupTransmissions(){
    for(var i = -1; i < 4; i++){
        $("#transmissions").append(`<button type='button' mod-value='13' value='${i}' class='list-group-item list-group-item-action mods'>Transmission ${i + 2}</button>`);
    }
}

function setupSuspensionsAndHydraulics(hydraulics){
    for(var i = -1; i < 4; i++){
        $("#suspensions").append(`<button type='button' mod-value='15' value='${i}' class='list-group-item list-group-item-action mods'>Suspension ${i + 2}</button>`);
    }
    for(var i = -1; i < hydraulics; i++){
        $("#hydraulics").append(`<button type='button' mod-value='38' value='${i}' class='list-group-item list-group-item-action mods'>Hydraulic ${i + 2}</button>`);
    }
}

function setupHorns(){
    for(var i = -1; i < 35; i++){
        $("#horns").append(`<button type='button' mod-value='14' value='${i}' class='list-group-item list-group-item-action mods'>Horn ${i + 2}</button>`);
    }
}

function setupPlates(){
    for(var i = 0; i < 6; i++){
        $("#plates").append(`<button type='button' mod-value='53' value='${i}' class='list-group-item list-group-item-action mods'>Plate ${i + 1}</button>`);
    }
}

function setupArmorsAndWindows(armors){
    for(var i = -1; i < armors; i++){
        $("#armors").append(`<button type='button' mod-value='16' value='${i}' class='list-group-item list-group-item-action mods'>Armor ${i + 1}</button>`);
    }
    for(var i = -1; i < 3; i++){
        $("#windows").append(`<button type='button' mod-value='46' value='${i}' class='list-group-item list-group-item-action mods'>Window ${i + 1}</button>`);
    }
}

// Handles the dropdown menu and will hide and show the approiate divs based on the users choice
$(document).on('click', '.dropdown-item', function () {
    var content = $("#content");
    content.children('.content-child').hide();
    content.find("#child" + $(this).attr("data-value")).show()
    $("#dropdownMenu").text($(this).text());
});

// Handles the wheel type radio buttons
$(document).on('click', '.wheel-type', function () {
    currentWheelType = $(this).val();
    // Remove all previously added wheels
    $("#wheels").empty();
    // Populate the list with all the wheels available
    let wheelsForType = allWheels[$(this).val()];
    for(var i = 0; i < wheelsForType.length; i++){
        $("#wheels").append(`<button type='button' mod-value='${wheelsForType[i].mod}' value='${wheelsForType[i].value}' class='list-group-item list-group-item-action wheels'>${wheelsForType[i].name}</button>`);
    }
});

// Handle the wheels list when you click on a wheel 
$(document).on('click', '.wheels', function () {
    currentWheel = $(this).val();
    currentWheelModType = $(this).attr('mod-value');
    mp.trigger("SetVehicleWheels::Client", currentWheelModType, currentWheelType, currentWheel);
});

$(document).on('click', '.mods', function () {
    let modVal = $(this).val();
    let modType = $(this).attr('mod-value');
    modValuesToBuy[modType] = modVal;

    // Special cases where the regular setMod wont work
    if(modType == '46'){
        // Window tint
        mp.trigger("SetVehicleWindowTint::Client", modVal);
    }else{
        mp.trigger("SetVehicleMod::Client", modType, modVal);
    }
});

function setupColorPicker(pickerID, revertColor) {
    // Create the spectrum
    $(pickerID).spectrum({
        type: "flat",
        color: revertColor,
        showAlpha: false,
        showPalette: false,
        cancelText: "Revert",
        chooseText: "Purchase",
        allowEmpty: false,
        showButtons: false,
        preferredFormat: "rgb"
    });

    // Setup the event whenever the player stops dragging around
    $(pickerID).on("dragstop.spectrum", function (e, color) {
        if(pickerID.includes("primary")){
            currentPrimaryColor = color.toRgb();
            mp.trigger("SetVehiclePrimaryColor::Client", currentPrimaryColor.r, currentPrimaryColor.g, currentPrimaryColor.b);
        }else{
            currentSecondaryColor = color.toRgb();
            mp.trigger("SetVehicleSecondaryColor::Client", currentSecondaryColor.r, currentSecondaryColor.g, currentSecondaryColor.b);
        }
    });

    // Setup event for whenever the player clicks the 'Revert' button
    $(pickerID + "-revert").click(function () {
        if(pickerID.includes("primary")){
            $(pickerID).spectrum("set", oldPrimaryColor);
            mp.trigger("SetVehiclePrimaryColor::Client", oldPrimaryColorAsObj.r, oldPrimaryColorAsObj.g, oldPrimaryColorAsObj.b);
        }else{
            $(pickerID).spectrum("set", oldSecondaryColor);
            mp.trigger("SetVehicleSecondaryColor::Client", oldSecondaryColorAsObj.r, oldSecondaryColorAsObj.g, oldSecondaryColorAsObj.b);
        }
    });
}

// Purchase buttons
function purchasePrimaryColor(){
    if(currentPrimaryColor !== null)
        mp.trigger("PurchasePrimaryVehicleColor::Client", currentPrimaryColor.r, currentPrimaryColor.g, currentPrimaryColor.b);
}

function purchaseSecondaryColor(){
    if(currentSecondaryColor !== null)
        mp.trigger("PurchaseSecondaryVehicleColor::Client", currentSecondaryColor.r, currentSecondaryColor.g, currentSecondaryColor.b);
}

function purchaseWheel(){
    if(currentWheelType === null || currentWheel === null)
        return;

    mp.trigger("PurchaseVehicleWheel::Client", currentWheelModType, currentWheelType, currentWheel);
}

function purchaseMod(modType){
    // Get the modvalue to purchase
    if(modType in modValuesToBuy){
        let modValue = modValuesToBuy[modType];
        mp.trigger("PurchaseVehicleMod::Client", modType, modValue);
    }
}

function closeWindow(){
    mp.trigger("DestroyVehicleModding::Client");
}

